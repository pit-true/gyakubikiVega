<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒã‚±ãƒ¢ãƒ³ â‡„ æŠ€ æ¤œç´¢</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="searchmove_style.css">
</head>
<body>

<h1>ãƒã‚±ãƒ¢ãƒ³ â‡„ æŠ€ æ¤œç´¢</h1>
<div class="note">2æ–‡å­—ä»¥ä¸Šå…¥åŠ›ã§æ¤œç´¢ã—ã¾ã™</div>

<div class="box">
  <h2>ğŸ” æŠ€å â†’ è¦šãˆã‚‹ãƒã‚±ãƒ¢ãƒ³</h2>
  <input id="moveInput" placeholder="ä¾‹ï¼šã‚Œã‚“ã”ã / ã—ã‚“ãã">
  <ul id="moveResult"></ul>
</div>

<div class="box">
  <h2>ğŸ” ãƒã‚±ãƒ¢ãƒ³å â†’ è¦šãˆã‚‹æŠ€</h2>
  <input id="pokemonInput" placeholder="ä¾‹ï¼šã‚¢ã‚¹ãƒ•ã‚£ã‚¢">
  <ul id="pokemonResult"></ul>
</div>

<script>
// JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
let pokemonData = [];
let moveDetails = {};

Promise.all([
  fetch('vega_all_pokemon_data.json').then(r => r.json()),
  fetch('move_details.json').then(r => r.json())
])
.then(([pData, mData]) => {
  pokemonData = pData;
  moveDetails = mData;
  console.log(`Loaded ${pokemonData.length} Pokemon and ${Object.keys(moveDetails).length} moves`);
})
.catch(err => {
  console.error('Failed to load data:', err);
  document.getElementById("moveResult").innerHTML = "<li>ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</li>";
  document.getElementById("pokemonResult").innerHTML = "<li>ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</li>";
});

// ===============================
// æ–‡å­—æ•°2ä»¥ä¸Š + å…¥åŠ›åœæ­¢300mså¾Œã«æ¤œç´¢
// ===============================
let moveTimer = null;
let pokemonTimer = null;

// ========= æŠ€ â†’ ãƒã‚±ãƒ¢ãƒ³ =========
document.getElementById("moveInput").addEventListener("input", function () {
  clearTimeout(moveTimer);
  const word = this.value.trim();
  const result = document.getElementById("moveResult");
  result.innerHTML = "";

  if (word.length < 2) return;

  moveTimer = setTimeout(() => {
    if (pokemonData.length === 0) {
      result.innerHTML = "<li>ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­...</li>";
      return;
    }

    console.log("Searching for move:", word);
    const hit = pokemonData.filter(p =>
      Array.isArray(p.moves) &&
      p.moves.some(m => m === word || m.includes(word))
    );
    console.log("Found Pokemon:", hit.length);

    if (hit.length === 0) {
      result.innerHTML = "<li>å€™è£œãªã—ï¼ˆ" + pokemonData.length + "ä½“ä¸­0ä½“ï¼‰</li>";
      return;
    }

    hit.forEach(p => {
      const li = document.createElement("li");
      if (p.url) {
        const a = document.createElement("a");
        a.href = p.url;
        a.textContent = p.name;
        a.className = "pokemon-link";
        a.target = "_blank";
        li.appendChild(a);
      } else {
        li.textContent = p.name;
      }
      result.appendChild(li);
    });
  }, 300);
});

// ========= ãƒã‚±ãƒ¢ãƒ³ â†’ æŠ€ =========
document.getElementById("pokemonInput").addEventListener("input", function () {
  clearTimeout(pokemonTimer);
  const word = this.value.trim();
  const result = document.getElementById("pokemonResult");
  result.innerHTML = "";

  if (word.length < 2) return;

  pokemonTimer = setTimeout(() => {
    if (pokemonData.length === 0) {
      result.innerHTML = "<li>ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­...</li>";
      return;
    }

    const hit = pokemonData.filter(p =>
      p.name.includes(word) ||
      (p.hiragana && p.hiragana.includes(word)) ||
      (p.romaji && p.romaji.toLowerCase().includes(word.toLowerCase()))
    );

    if (hit.length === 0) {
      result.innerHTML = "<li>å€™è£œãªã—</li>";
      return;
    }

    const found = hit[0];
    if (!Array.isArray(found.moves) || found.moves.length === 0) {
      result.innerHTML = "<li>æŠ€ãƒ‡ãƒ¼ã‚¿ãªã—</li>";
      return;
    }

    found.moves.forEach(moveName => {
      const li = document.createElement("li");
      const span = document.createElement("span");
      span.textContent = moveName;
      span.className = "move-name";

      // Check if this move has details
      if (moveDetails[moveName]) {
        span.className += " expandable";
        span.style.cursor = "pointer";

        // Create detail div
        const detailDiv = document.createElement("div");
        detailDiv.className = "move-detail";
        detailDiv.textContent = moveDetails[moveName].formatted_description || moveDetails[moveName].description;

        // Toggle on click
        span.addEventListener("click", function() {
          detailDiv.classList.toggle("show");
        });

        li.appendChild(span);
        li.appendChild(detailDiv);
      } else {
        li.appendChild(span);
      }

      result.appendChild(li);
    });
  }, 300);
});
</script>

</body>
</html>
